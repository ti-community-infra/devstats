{
  "id": "6198403192",
  "type": "PullRequestReviewCommentEvent",
  "actor": {
    "id": 8961614,
    "login": "DellaBitta",
    "display_login": "DellaBitta",
    "gravatar_id": "",
    "url": "https://api.github.com/users/DellaBitta",
    "avatar_url": "https://avatars.githubusercontent.com/u/8961614?"
  },
  "repo": {
    "id": 65734711,
    "name": "xively/xively-client-c",
    "url": "https://api.github.com/repos/xively/xively-client-c"
  },
  "payload": {
    "action": "created",
    "comment": {
      "url": "https://api.github.com/repos/xively/xively-client-c/pulls/comments/125719174",
      "pull_request_review_id": 48108207,
      "id": 125719174,
      "diff_hunk": "@@ -121,55 +115,106 @@ void xi_cbor_codec_ct_encode( const xi_control_message_t* control_message,\n             }\n             break;\n \n-        case XI_CONTROL_MESSAGE_CS_FILE_GET_CHUNK:\n+        case XI_CONTROL_MESSAGE_CS__SFT_FILE_GET_CHUNK:\n \n             xi_cbor_put_name_and_revision( cb_map, control_message->file_get_chunk.name,\n                                            control_message->file_get_chunk.revision,\n                                            &err );\n \n             cn_cbor_map_put(\n-                cb_map, cn_cbor_string_create( \"O\" CBOR_CONTEXT_PARAM, &err ),\n+                cb_map,\n+                cn_cbor_string_create(\n+                    XI_CBOR_CODEC_CT_STRING_FILECHUNK_OFFSET CBOR_CONTEXT_PARAM, &err ),\n                 cn_cbor_int_create(\n                     control_message->file_get_chunk.offset CBOR_CONTEXT_PARAM, &err ),\n                 &err );\n \n             cn_cbor_map_put(\n-                cb_map, cn_cbor_string_create( \"L\" CBOR_CONTEXT_PARAM, &err ),\n+                cb_map,\n+                cn_cbor_string_create(\n+                    XI_CBOR_CODEC_CT_STRING_FILECHUNK_LENGTH CBOR_CONTEXT_PARAM, &err ),\n                 cn_cbor_int_create(\n                     control_message->file_get_chunk.length CBOR_CONTEXT_PARAM, &err ),\n                 &err );\n \n             break;\n \n-        case XI_CONTROL_MESSAGE_CS_FILE_STATUS:\n+        case XI_CONTROL_MESSAGE_CS__SFT_FILE_STATUS:\n \n-            // todo_atigyi\n+            xi_cbor_put_name_and_revision( cb_map, control_message->file_status.name,\n+                                           control_message->file_status.revision, &err );\n+\n+            cn_cbor_map_put(\n+                cb_map,\n+                cn_cbor_string_create(\n+                    XI_CBOR_CODEC_CT_STRING_FILESTATUS_PHASE CBOR_CONTEXT_PARAM, &err ),\n+                cn_cbor_int_create( control_message->file_status.phase CBOR_CONTEXT_PARAM,\n+                                    &err ),\n+                &err );\n+\n+            cn_cbor_map_put(\n+                cb_map,\n+                cn_cbor_string_create(\n+                    XI_CBOR_CODEC_CT_STRING_FILESTATUS_CODE CBOR_CONTEXT_PARAM, &err ),\n+                cn_cbor_int_create( control_message->file_status.code CBOR_CONTEXT_PARAM,\n+                                    &err ),\n+                &err );\n \n             break;\n \n         /* the followings are encoded by the broker and decoded by the client */\n-        case XI_CONTROL_MESSAGE_SC_FILE_UPDATE_AVAILABLE:\n-        case XI_CONTROL_MESSAGE_SC_FILE_CHUNK:\n-        default:\n-            cn_cbor_free( cb_map CBOR_CONTEXT_PARAM );\n-            return;\n+        case XI_CONTROL_MESSAGE_SC__SFT_FILE_UPDATE_AVAILABLE:\n+        case XI_CONTROL_MESSAGE_SC__SFT_FILE_CHUNK:\n+        default:;\n     }\n \n-    unsigned char encoded[512];\n-    *out_len = cn_cbor_encoder_write( encoded, 0, sizeof( encoded ), cb_map );\n+    xi_state_t state = XI_STATE_OK;\n+\n+    uint8_t* encoded     = NULL;\n+    uint32_t encoded_len = 256;\n+\n+    for ( ; encoded_len < 100000; encoded_len *= 2 )",
      "path": "src/libxively/cbor/xi_cbor_codec_ct.c",
      "position": 124,
      "original_position": 124,
      "commit_id": "e470bf7440629b6a8a769209a847e8336904cc4c",
      "original_commit_id": "e470bf7440629b6a8a769209a847e8336904cc4c",
      "user": {
        "login": "DellaBitta",
        "id": 8961614,
        "avatar_url": "https://avatars0.githubusercontent.com/u/8961614?v=3",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DellaBitta",
        "html_url": "https://github.com/DellaBitta",
        "followers_url": "https://api.github.com/users/DellaBitta/followers",
        "following_url": "https://api.github.com/users/DellaBitta/following{/other_user}",
        "gists_url": "https://api.github.com/users/DellaBitta/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/DellaBitta/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/DellaBitta/subscriptions",
        "organizations_url": "https://api.github.com/users/DellaBitta/orgs",
        "repos_url": "https://api.github.com/users/DellaBitta/repos",
        "events_url": "https://api.github.com/users/DellaBitta/events{/privacy}",
        "received_events_url": "https://api.github.com/users/DellaBitta/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I would also allow for the starting value to be a preprocessor defintion, too, so that people can set them to be the same if they don't want to play too much with the heap.",
      "created_at": "2017-07-05T18:15:19Z",
      "updated_at": "2017-07-05T19:04:32Z",
      "html_url": "https://github.com/xively/xively-client-c/pull/128#discussion_r125719174",
      "pull_request_url": "https://api.github.com/repos/xively/xively-client-c/pulls/128",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/xively/xively-client-c/pulls/comments/125719174"
        },
        "html": {
          "href": "https://github.com/xively/xively-client-c/pull/128#discussion_r125719174"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/xively/xively-client-c/pulls/128"
        }
      }
    },
    "pull_request": {
      "url": "https://api.github.com/repos/xively/xively-client-c/pulls/128",
      "id": 128934612,
      "html_url": "https://github.com/xively/xively-client-c/pull/128",
      "diff_url": "https://github.com/xively/xively-client-c/pull/128.diff",
      "patch_url": "https://github.com/xively/xively-client-c/pull/128.patch",
      "issue_url": "https://api.github.com/repos/xively/xively-client-c/issues/128",
      "number": 128,
      "state": "open",
      "locked": false,
      "title": "Feature/sft protocol impl",
      "user": {
        "login": "atigyi",
        "id": 7406739,
        "avatar_url": "https://avatars3.githubusercontent.com/u/7406739?v=3",
        "gravatar_id": "",
        "url": "https://api.github.com/users/atigyi",
        "html_url": "https://github.com/atigyi",
        "followers_url": "https://api.github.com/users/atigyi/followers",
        "following_url": "https://api.github.com/users/atigyi/following{/other_user}",
        "gists_url": "https://api.github.com/users/atigyi/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/atigyi/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/atigyi/subscriptions",
        "organizations_url": "https://api.github.com/users/atigyi/orgs",
        "repos_url": "https://api.github.com/users/atigyi/repos",
        "events_url": "https://api.github.com/users/atigyi/events{/privacy}",
        "received_events_url": "https://api.github.com/users/atigyi/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "[ Description ]\r\nSFT protocol implementation. Client now behaves like a valid SFT client. Sends up FILE_INFO at start, accepts and processes FILE_UPDATE_AVAILABLE (FUA). Starts file download with FILE_GET_CHUNK messages and goes through all files in FUA message one-by-one. Obviously accepts and processes FILE_CHUNK messages and sends back FILE_STATUS messages to each downloaded file. All these new functionalities are unit tested and integration tests are added too testing the control topic - mqtt logic - mqtt codec layers with a mock broker which now supports SFT protocol. The mock broker is basically a happy broker but minor control for misbehaviour is available for test cases. \r\nSFT feature is disabled for current builds. It'll be enabled as soon as FWU feature is fully implemented.\r\n\r\n[ JIRA ]\r\nSFT implementation inside libxively\r\nXCL-2938\r\n\r\n[ Reviewer ]\r\n\r\n[ QA ]\r\nUnit and integration tests cover new functionality. Also manual test was done against live Xively broker. \r\n\r\n[ Release Notes ]",
      "created_at": "2017-07-05T10:51:21Z",
      "updated_at": "2017-07-05T19:04:33Z",
      "closed_at": null,
      "merged_at": null,
      "merge_commit_sha": "456abfee2c5eac24c32ec4ad4c35cd86ddf5ec26",
      "assignee": null,
      "assignees": [

      ],
      "requested_reviewers": [

      ],
      "milestone": null,
      "commits_url": "https://api.github.com/repos/xively/xively-client-c/pulls/128/commits",
      "review_comments_url": "https://api.github.com/repos/xively/xively-client-c/pulls/128/comments",
      "review_comment_url": "https://api.github.com/repos/xively/xively-client-c/pulls/comments{/number}",
      "comments_url": "https://api.github.com/repos/xively/xively-client-c/issues/128/comments",
      "statuses_url": "https://api.github.com/repos/xively/xively-client-c/statuses/e470bf7440629b6a8a769209a847e8336904cc4c",
      "head": {
        "label": "xively:feature/sft_protocol_impl",
        "ref": "feature/sft_protocol_impl",
        "sha": "e470bf7440629b6a8a769209a847e8336904cc4c",
        "user": {
          "login": "xively",
          "id": 4222960,
          "avatar_url": "https://avatars2.githubusercontent.com/u/4222960?v=3",
          "gravatar_id": "",
          "url": "https://api.github.com/users/xively",
          "html_url": "https://github.com/xively",
          "followers_url": "https://api.github.com/users/xively/followers",
          "following_url": "https://api.github.com/users/xively/following{/other_user}",
          "gists_url": "https://api.github.com/users/xively/gists{/gist_id}",
          "starred_url": "https://api.github.com/users/xively/starred{/owner}{/repo}",
          "subscriptions_url": "https://api.github.com/users/xively/subscriptions",
          "organizations_url": "https://api.github.com/users/xively/orgs",
          "repos_url": "https://api.github.com/users/xively/repos",
          "events_url": "https://api.github.com/users/xively/events{/privacy}",
          "received_events_url": "https://api.github.com/users/xively/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "repo": {
          "id": 65734711,
          "name": "xively-client-c",
          "full_name": "xively/xively-client-c",
          "owner": {
            "login": "xively",
            "id": 4222960,
            "avatar_url": "https://avatars2.githubusercontent.com/u/4222960?v=3",
            "gravatar_id": "",
            "url": "https://api.github.com/users/xively",
            "html_url": "https://github.com/xively",
            "followers_url": "https://api.github.com/users/xively/followers",
            "following_url": "https://api.github.com/users/xively/following{/other_user}",
            "gists_url": "https://api.github.com/users/xively/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/xively/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/xively/subscriptions",
            "organizations_url": "https://api.github.com/users/xively/orgs",
            "repos_url": "https://api.github.com/users/xively/repos",
            "events_url": "https://api.github.com/users/xively/events{/privacy}",
            "received_events_url": "https://api.github.com/users/xively/received_events",
            "type": "Organization",
            "site_admin": false
          },
          "private": false,
          "html_url": "https://github.com/xively/xively-client-c",
          "description": "The official and highly portable Xively C Client designed for embedded platforms.",
          "fork": false,
          "url": "https://api.github.com/repos/xively/xively-client-c",
          "forks_url": "https://api.github.com/repos/xively/xively-client-c/forks",
          "keys_url": "https://api.github.com/repos/xively/xively-client-c/keys{/key_id}",
          "collaborators_url": "https://api.github.com/repos/xively/xively-client-c/collaborators{/collaborator}",
          "teams_url": "https://api.github.com/repos/xively/xively-client-c/teams",
          "hooks_url": "https://api.github.com/repos/xively/xively-client-c/hooks",
          "issue_events_url": "https://api.github.com/repos/xively/xively-client-c/issues/events{/number}",
          "events_url": "https://api.github.com/repos/xively/xively-client-c/events",
          "assignees_url": "https://api.github.com/repos/xively/xively-client-c/assignees{/user}",
          "branches_url": "https://api.github.com/repos/xively/xively-client-c/branches{/branch}",
          "tags_url": "https://api.github.com/repos/xively/xively-client-c/tags",
          "blobs_url": "https://api.github.com/repos/xively/xively-client-c/git/blobs{/sha}",
          "git_tags_url": "https://api.github.com/repos/xively/xively-client-c/git/tags{/sha}",
          "git_refs_url": "https://api.github.com/repos/xively/xively-client-c/git/refs{/sha}",
          "trees_url": "https://api.github.com/repos/xively/xively-client-c/git/trees{/sha}",
          "statuses_url": "https://api.github.com/repos/xively/xively-client-c/statuses/{sha}",
          "languages_url": "https://api.github.com/repos/xively/xively-client-c/languages",
          "stargazers_url": "https://api.github.com/repos/xively/xively-client-c/stargazers",
          "contributors_url": "https://api.github.com/repos/xively/xively-client-c/contributors",
          "subscribers_url": "https://api.github.com/repos/xively/xively-client-c/subscribers",
          "subscription_url": "https://api.github.com/repos/xively/xively-client-c/subscription",
          "commits_url": "https://api.github.com/repos/xively/xively-client-c/commits{/sha}",
          "git_commits_url": "https://api.github.com/repos/xively/xively-client-c/git/commits{/sha}",
          "comments_url": "https://api.github.com/repos/xively/xively-client-c/comments{/number}",
          "issue_comment_url": "https://api.github.com/repos/xively/xively-client-c/issues/comments{/number}",
          "contents_url": "https://api.github.com/repos/xively/xively-client-c/contents/{+path}",
          "compare_url": "https://api.github.com/repos/xively/xively-client-c/compare/{base}...{head}",
          "merges_url": "https://api.github.com/repos/xively/xively-client-c/merges",
          "archive_url": "https://api.github.com/repos/xively/xively-client-c/{archive_format}{/ref}",
          "downloads_url": "https://api.github.com/repos/xively/xively-client-c/downloads",
          "issues_url": "https://api.github.com/repos/xively/xively-client-c/issues{/number}",
          "pulls_url": "https://api.github.com/repos/xively/xively-client-c/pulls{/number}",
          "milestones_url": "https://api.github.com/repos/xively/xively-client-c/milestones{/number}",
          "notifications_url": "https://api.github.com/repos/xively/xively-client-c/notifications{?since,all,participating}",
          "labels_url": "https://api.github.com/repos/xively/xively-client-c/labels{/name}",
          "releases_url": "https://api.github.com/repos/xively/xively-client-c/releases{/id}",
          "deployments_url": "https://api.github.com/repos/xively/xively-client-c/deployments",
          "created_at": "2016-08-15T13:35:30Z",
          "updated_at": "2017-05-29T09:11:40Z",
          "pushed_at": "2017-07-05T17:52:01Z",
          "git_url": "git://github.com/xively/xively-client-c.git",
          "ssh_url": "git@github.com:xively/xively-client-c.git",
          "clone_url": "https://github.com/xively/xively-client-c.git",
          "svn_url": "https://github.com/xively/xively-client-c",
          "homepage": "",
          "size": 14119,
          "stargazers_count": 8,
          "watchers_count": 8,
          "language": "C",
          "has_issues": true,
          "has_projects": true,
          "has_downloads": true,
          "has_wiki": true,
          "has_pages": false,
          "forks_count": 3,
          "mirror_url": null,
          "open_issues_count": 2,
          "forks": 3,
          "open_issues": 2,
          "watchers": 8,
          "default_branch": "master"
        }
      },
      "base": {
        "label": "xively:development",
        "ref": "development",
        "sha": "7abf4320e9c7827082abbaf9c6a4c97f569ea18e",
        "user": {
          "login": "xively",
          "id": 4222960,
          "avatar_url": "https://avatars2.githubusercontent.com/u/4222960?v=3",
          "gravatar_id": "",
          "url": "https://api.github.com/users/xively",
          "html_url": "https://github.com/xively",
          "followers_url": "https://api.github.com/users/xively/followers",
          "following_url": "https://api.github.com/users/xively/following{/other_user}",
          "gists_url": "https://api.github.com/users/xively/gists{/gist_id}",
          "starred_url": "https://api.github.com/users/xively/starred{/owner}{/repo}",
          "subscriptions_url": "https://api.github.com/users/xively/subscriptions",
          "organizations_url": "https://api.github.com/users/xively/orgs",
          "repos_url": "https://api.github.com/users/xively/repos",
          "events_url": "https://api.github.com/users/xively/events{/privacy}",
          "received_events_url": "https://api.github.com/users/xively/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "repo": {
          "id": 65734711,
          "name": "xively-client-c",
          "full_name": "xively/xively-client-c",
          "owner": {
            "login": "xively",
            "id": 4222960,
            "avatar_url": "https://avatars2.githubusercontent.com/u/4222960?v=3",
            "gravatar_id": "",
            "url": "https://api.github.com/users/xively",
            "html_url": "https://github.com/xively",
            "followers_url": "https://api.github.com/users/xively/followers",
            "following_url": "https://api.github.com/users/xively/following{/other_user}",
            "gists_url": "https://api.github.com/users/xively/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/xively/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/xively/subscriptions",
            "organizations_url": "https://api.github.com/users/xively/orgs",
            "repos_url": "https://api.github.com/users/xively/repos",
            "events_url": "https://api.github.com/users/xively/events{/privacy}",
            "received_events_url": "https://api.github.com/users/xively/received_events",
            "type": "Organization",
            "site_admin": false
          },
          "private": false,
          "html_url": "https://github.com/xively/xively-client-c",
          "description": "The official and highly portable Xively C Client designed for embedded platforms.",
          "fork": false,
          "url": "https://api.github.com/repos/xively/xively-client-c",
          "forks_url": "https://api.github.com/repos/xively/xively-client-c/forks",
          "keys_url": "https://api.github.com/repos/xively/xively-client-c/keys{/key_id}",
          "collaborators_url": "https://api.github.com/repos/xively/xively-client-c/collaborators{/collaborator}",
          "teams_url": "https://api.github.com/repos/xively/xively-client-c/teams",
          "hooks_url": "https://api.github.com/repos/xively/xively-client-c/hooks",
          "issue_events_url": "https://api.github.com/repos/xively/xively-client-c/issues/events{/number}",
          "events_url": "https://api.github.com/repos/xively/xively-client-c/events",
          "assignees_url": "https://api.github.com/repos/xively/xively-client-c/assignees{/user}",
          "branches_url": "https://api.github.com/repos/xively/xively-client-c/branches{/branch}",
          "tags_url": "https://api.github.com/repos/xively/xively-client-c/tags",
          "blobs_url": "https://api.github.com/repos/xively/xively-client-c/git/blobs{/sha}",
          "git_tags_url": "https://api.github.com/repos/xively/xively-client-c/git/tags{/sha}",
          "git_refs_url": "https://api.github.com/repos/xively/xively-client-c/git/refs{/sha}",
          "trees_url": "https://api.github.com/repos/xively/xively-client-c/git/trees{/sha}",
          "statuses_url": "https://api.github.com/repos/xively/xively-client-c/statuses/{sha}",
          "languages_url": "https://api.github.com/repos/xively/xively-client-c/languages",
          "stargazers_url": "https://api.github.com/repos/xively/xively-client-c/stargazers",
          "contributors_url": "https://api.github.com/repos/xively/xively-client-c/contributors",
          "subscribers_url": "https://api.github.com/repos/xively/xively-client-c/subscribers",
          "subscription_url": "https://api.github.com/repos/xively/xively-client-c/subscription",
          "commits_url": "https://api.github.com/repos/xively/xively-client-c/commits{/sha}",
          "git_commits_url": "https://api.github.com/repos/xively/xively-client-c/git/commits{/sha}",
          "comments_url": "https://api.github.com/repos/xively/xively-client-c/comments{/number}",
          "issue_comment_url": "https://api.github.com/repos/xively/xively-client-c/issues/comments{/number}",
          "contents_url": "https://api.github.com/repos/xively/xively-client-c/contents/{+path}",
          "compare_url": "https://api.github.com/repos/xively/xively-client-c/compare/{base}...{head}",
          "merges_url": "https://api.github.com/repos/xively/xively-client-c/merges",
          "archive_url": "https://api.github.com/repos/xively/xively-client-c/{archive_format}{/ref}",
          "downloads_url": "https://api.github.com/repos/xively/xively-client-c/downloads",
          "issues_url": "https://api.github.com/repos/xively/xively-client-c/issues{/number}",
          "pulls_url": "https://api.github.com/repos/xively/xively-client-c/pulls{/number}",
          "milestones_url": "https://api.github.com/repos/xively/xively-client-c/milestones{/number}",
          "notifications_url": "https://api.github.com/repos/xively/xively-client-c/notifications{?since,all,participating}",
          "labels_url": "https://api.github.com/repos/xively/xively-client-c/labels{/name}",
          "releases_url": "https://api.github.com/repos/xively/xively-client-c/releases{/id}",
          "deployments_url": "https://api.github.com/repos/xively/xively-client-c/deployments",
          "created_at": "2016-08-15T13:35:30Z",
          "updated_at": "2017-05-29T09:11:40Z",
          "pushed_at": "2017-07-05T17:52:01Z",
          "git_url": "git://github.com/xively/xively-client-c.git",
          "ssh_url": "git@github.com:xively/xively-client-c.git",
          "clone_url": "https://github.com/xively/xively-client-c.git",
          "svn_url": "https://github.com/xively/xively-client-c",
          "homepage": "",
          "size": 14119,
          "stargazers_count": 8,
          "watchers_count": 8,
          "language": "C",
          "has_issues": true,
          "has_projects": true,
          "has_downloads": true,
          "has_wiki": true,
          "has_pages": false,
          "forks_count": 3,
          "mirror_url": null,
          "open_issues_count": 2,
          "forks": 3,
          "open_issues": 2,
          "watchers": 8,
          "default_branch": "master"
        }
      },
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/xively/xively-client-c/pulls/128"
        },
        "html": {
          "href": "https://github.com/xively/xively-client-c/pull/128"
        },
        "issue": {
          "href": "https://api.github.com/repos/xively/xively-client-c/issues/128"
        },
        "comments": {
          "href": "https://api.github.com/repos/xively/xively-client-c/issues/128/comments"
        },
        "review_comments": {
          "href": "https://api.github.com/repos/xively/xively-client-c/pulls/128/comments"
        },
        "review_comment": {
          "href": "https://api.github.com/repos/xively/xively-client-c/pulls/comments{/number}"
        },
        "commits": {
          "href": "https://api.github.com/repos/xively/xively-client-c/pulls/128/commits"
        },
        "statuses": {
          "href": "https://api.github.com/repos/xively/xively-client-c/statuses/e470bf7440629b6a8a769209a847e8336904cc4c"
        }
      }
    }
  },
  "public": true,
  "created_at": "2017-07-05T18:15:19Z",
  "org": {
    "id": 4222960,
    "login": "xively",
    "gravatar_id": "",
    "url": "https://api.github.com/orgs/xively",
    "avatar_url": "https://avatars.githubusercontent.com/u/4222960?"
  },
  "a_structure": "{action:,comment:,pull_request:}"
}